import React, { createContext, useContext, useMemo, useState } from 'react'

const strings = {
  en: {
    appTitle: 'Currency Exchange Manager',
    nav: { 
      dashboard: 'Dashboard', 
      withdrawals: 'Withdrawals & Reports', 
      create: 'Create Entities',
      cashier: 'Cashier Interface',
      executioner: 'Dealership Executioner',
      debtManagement: 'Debt Management',
      treasurer: 'Treasury Management',
      cashCustody: 'Cash Custody',
      userManagement: 'User Management',
      walletManagement: 'Wallet Management',
      changePassword: 'Change Password',
      logout: 'Sign Out',
      account: 'Account',
      menu: 'Menu'
    },
    // Flattened keys for convenience
    'userManagement.title': 'User Management',
    'userManagement.users': 'Users',
    'userManagement.email': 'Email',
    'userManagement.name': 'Name',
    'userManagement.currentRole': 'Current Role',
    'userManagement.assignRole': 'Assign Role',
    'userManagement.loadingUsers': 'Loading users...',
    'userManagement.noUsersFound': 'No users found',
    'userManagement.noRoleAssigned': 'No role assigned',
    'userManagement.roleUpdated': 'Role updated successfully',
    'userManagement.failedToLoad': 'Failed to load',
    'userManagement.couldNotLoadUsers': 'Could not load users',
    'userManagement.roleUpdateFailed': 'Failed to update role',
    'userManagement.roleUpdateSuccess': 'User role has been updated successfully',

    'roles.manager': 'Manager',
    'roles.treasurer': 'Treasurer',
    'roles.cashier': 'Cashier',
    'roles.dealings_executioner': 'Dealings Executioner',
    'roles.selectRole': 'Select a role',
    'roles.loadingRoles': 'Loading roles...',
    'roles.noRolesAvailable': 'No roles available',
    'roles.solution': 'Solution',
    'roles.runFixRoles': 'Run npm run fix:roles to fix.',
    'roles.noRolesInDatabase': 'No roles found in the database.',
    'roles.runFixRolesToCreate': 'Run npm run fix:roles to create the roles table.',

    'create.role': 'Role',
    'create.title': 'Create Entities',
    'create.wallet': 'Create Wallet',
    'create.name': 'Name',
    'create.initUsd': 'Initial USD',
    'create.initLyd': 'Initial LYD',
    'create.create': 'Create',
    'create.user': 'Create User',
    'create.email': 'Email',
    'create.phone': 'Phone',
    'create.password': 'Password',
    'create.operation': 'Create Operation',
    'create.operationName': 'Operation Name',
    'create.currencyType': 'Create Currency Type',
    'create.currencyCode': 'Currency Code',
    'create.currencyName': 'Currency Name',
    'create.currencySymbol': 'Currency Symbol (Optional)',
    'create.addCurrency': 'Add Currency',
    'create.initialBalance': 'Initial Balance',
    
    'custodyManagement.title': 'Cash Custody Management',
    'custodyManagement.refresh': 'Refresh',
    'custodyManagement.custodyGiven': 'Custody Given',
    'custodyManagement.noCustodyGiven': 'No custody given',
    'custodyManagement.custodyReceived': 'Custody Received',
    'custodyManagement.noCustodyReceived': 'No custody received',
    'custodyManagement.date': 'Date',
    'custodyManagement.cashier': 'Cashier',
    'custodyManagement.treasurer': 'Treasurer',
    'custodyManagement.wallet': 'Wallet',
    'custodyManagement.amount': 'Amount',
    'custodyManagement.status': 'Status',
    'custodyManagement.actions': 'Actions',
    'custodyManagement.pending': 'Pending',
    'custodyManagement.approved': 'Approved',
    'custodyManagement.rejected': 'Rejected',
    'custodyManagement.returned': 'Returned',
    'custodyManagement.approve': 'Approve',
    'custodyManagement.reject': 'Reject',
    'custodyManagement.markReturned': 'Mark Returned',
    'custodyManagement.approvalSuccess': 'Custody request approved successfully',
    'custodyManagement.rejectionSuccess': 'Custody request rejected',
    'custodyManagement.returnSuccess': 'Custody marked as returned',
    'custodyManagement.approvalFailed': 'Approval failed',
    'custodyManagement.rejectionFailed': 'Rejection failed',
    'custodyManagement.returnFailed': 'Failed to mark custody as returned',
    
    // Dashboard flattened keys
    'dashboard.title': 'Dashboard',
    'dashboard.totals': 'Totals',
    'dashboard.totalUsd': 'Total USD',
    'dashboard.totalLyd': 'Total LYD',
    'dashboard.numWallets': 'Wallets',
    'dashboard.selectWallet': 'Select Wallet',
    'dashboard.walletBalances': 'Wallet Balances',
    'dashboard.usd': 'USD',
    'dashboard.lyd': 'LYD',
    'dashboard.buyInfo': 'Buying Dinar',
    'dashboard.sellInfo': 'Selling Dinar',
    'dashboard.lowest': 'Lowest',
    'dashboard.median': 'Median',
    'dashboard.highest': 'Highest',
    'dashboard.managerPrices': 'Manager Prices',
    'dashboard.sellold': 'Selling old dinar',
    'dashboard.sellnew': 'Selling new dinar',
    'dashboard.buyold': 'Buying old dinar',
    'dashboard.buynew': 'Buying new dinar',
    'dashboard.save': 'Save Prices',
    'dashboard.custodySummary': 'Custody Summary',
    'dashboard.summaryTotals': 'Summary Totals',
    
    // Currency Pairs
    'currencyPairs.pair': 'Currency Pair',
    'currencyPairs.medianRate': 'Median Rate',
    'currencyPairs.minRate': 'Min Rate',
    'currencyPairs.maxRate': 'Max Rate',
    'currencyPairs.transactions': 'Transactions',
    'currencyPairs.totalAmount': 'Total Amount',
    'currencyPairs.avgAmount': 'Avg',
    'currencyPairs.noData': 'No currency exchange data available',
    'currencyPairs.totalPairs': 'Total Currency Pairs',
    'currencyPairs.totalTransactions': 'Total Exchange Transactions',
    'currencyPairs.overallMedianRates': 'Overall Median Exchange Rates',
    'currencyPairs.basedOnTransactions': 'Based on',
    'currencyPairs.currencyPair': 'Currency Pair',
    'currencyPairs.marketActivity': 'Market Activity',
    'currencyPairs.calculator': 'Calculator',
    'currencyPairs.txs': 'txs',
    'currencyPairs.activePairs': 'Active Currency Pairs',
    'currencyPairs.totalExchanges': 'Total Exchanges',
    'currencyPairs.totalVolume': 'Total Volume',
    'currencyPairs.noExchangeData': 'No exchange transaction data available',
    'currencyPairs.walletAnalysis': 'Wallet Currency Analysis',
    'currencyPairs.exchangeRateAnalysis': 'Exchange Rate Analysis',
    'currencyPairs.enterAmount': 'Enter amount',
    'currencyPairs.convertedAmount': 'Converted Amount',
    'currencyPairs.rateUsed': 'Rate Used',
    'currencyPairs.operations': 'Operations',
    'currencyPairs.buying': 'Buying',
    'currencyPairs.selling': 'Selling',
    'currencyPairs.buy': 'Buy',
    'currencyPairs.sell': 'Sell',
    'currencyPairs.overallExchangeRates': 'Overall Exchange Rates',
    'currencyPairs.exchangeRateAnalysis': 'Exchange Rate Analysis',
    
    // Treasurer flattened keys
    'treasurer.title': 'Cash Custody Management',
    'treasurer.subtitle': 'Manage cash custody between treasurer and cashiers',
    'treasurer.giveCustody': 'Give Custody to Cashier',
    'treasurer.getCustody': 'Get Custody from Cashier',
    'treasurer.selectCashier': 'Select Cashier',
    'treasurer.cashierName': 'Cashier Name',
    'treasurer.currencyType': 'Currency Type',
    'treasurer.amount': 'Amount',
    'treasurer.selectAction': 'Select Action',
    'treasurer.actionRequired': 'Please select an action first',
    'treasurer.cashierRequired': 'Please select a cashier',
    'treasurer.currencyRequired': 'Please select a currency',
    'treasurer.amountRequired': 'Please enter an amount',
    'treasurer.amountInvalid': 'Please enter a valid amount',
    'treasurer.confirmCustody': 'Confirm Custody Transfer',
    'treasurer.successGive': 'Cash custody successfully given to cashier',
    'treasurer.successGet': 'Cash custody successfully received from cashier',
    'treasurer.notes': 'Notes (Optional)',
    'treasurer.processingCustody': 'Processing custody transfer...',
    'treasurer.insufficientFunds': 'Insufficient funds for this operation',
    'treasurer.selectCurrency': 'Select Currency',
    'treasurer.custodyHistory': 'Custody History',
    login: { title: 'Manager Login', email: 'Email', password: 'Password', submit: 'Login' },
    dashboard: {
      totals: 'Totals', totalUsd: 'Total USD', totalLyd: 'Total LYD', numWallets: 'Wallets',
      selectWallet: 'Select Wallet', walletBalances: 'Wallet Balances', usd: 'USD', lyd: 'LYD',
      buyInfo: 'Buying Dinar', sellInfo: 'Selling Dinar', lowest: 'Lowest', median: 'Median', highest: 'Highest',
      managerPrices: 'Manager Prices', sellold: 'Selling old dinar', sellnew: 'Selling new dinar', buyold: 'Buying old dinar', buynew: 'Buying new dinar', save: 'Save Prices'
    },    
    withdrawals: {
      title: 'Withdrawals & Reports', chooseWallet: 'Choose Wallet', usd: 'USD to withdraw', lyd: 'LYD to withdraw', reason: 'Reason', confirm: 'Confirm Withdraw',
      reportType: 'Report Type', exportPdf: 'Export PDF', currency: 'Currency to withdraw', amount: 'Amount to withdraw'
    },
    updatePassword: {
      title: 'Change Password', 
      newPassword: 'New Password', 
      confirmPassword: 'Confirm Password',
      passwordPlaceholder: 'Enter new password',
      confirmPasswordPlaceholder: 'Confirm new password',
      passwordRequired: 'Password is required',
      passwordLength: 'Password must be at least 6 characters',
      passwordMismatch: 'Passwords do not match',
      success: 'Password updated successfully',
      error: 'Failed to update password',
      updating: 'Updating...',
      submit: 'Update Password'
    },
    create: {
      title: 'Create Entities', wallet: 'Create Wallet', name: 'Name', initUsd: 'Initial USD', initLyd: 'Initial LYD', create: 'Create',
      user: 'Create User', email: 'Email', phone: 'Phone', password: 'Password',
      operation: 'Create Operation', operationName: 'Operation Name',
      currencyType: 'Create Currency Type', currencyCode: 'Currency Code', currencyName: 'Currency Name',
      currencySymbol: 'Currency Symbol (Optional)', addCurrency: 'Add Currency', initialBalance: 'Initial Balance'
    },
    common: {
      cancel: 'Cancel',
      back: 'Back',
      close: 'Close',
      save: 'Save',
      saving: 'Saving...',
      delete: 'Delete',
      deleted: 'Successfully deleted',
      paid: 'Mark as Paid',
      loading: 'Loading...',
      notes: 'Notes',
      selectOption: 'Select an option',
      failedToLoadData: 'Failed to load data',
      failedToSave: 'Failed to save',
      availableBalance: 'Available Balance',
      fillRequiredFields: 'Please fill all required fields',
      failed: 'Operation failed'
    },
    executioner: {
      title: 'Dealership Executioner',
      subtitle: 'Monitor and validate currency transactions',
      currentRates: 'Current Exchange Rates',
      transactions: 'Transaction Records',
      pending: 'Pending Validation',
      completed: 'Validated',
      needsValidation: 'Needs Validation',
      validate: 'Validate',
      details: 'Details',
      transactionType: 'Type',
      cashierName: 'Cashier',
      clientName: 'Client',
      source: 'Source',
      destination: 'Destination',
      amount: 'Amount',
      totalAmount: 'Total',
      status: 'Status',
      date: 'Date',
      time: 'Time',
      actions: 'Actions',
      buy: 'Buy',
      sell: 'Sell',
      filter: 'Filter',
      all: 'All',
      validated: 'Validated',
      notValidated: 'Not Validated',
      validateTransaction: 'Validate Transaction',
      validationConfirmation: 'Are you sure you want to validate this transaction?',
      transactionValidated: 'Transaction successfully validated',
      validatedBy: 'Validated by',
      validatedAt: 'Validated at',
      transactionDetails: 'Transaction Details',
      exchangeRate: 'Exchange Rate',
      wallet: 'Wallet',
      searchTransactions: 'Search transactions',
      noTransactions: 'No transactions found',
      highValue: 'High Value',
      needsAttention: 'Needs Attention'
    },
    debtManagement: {
      title: 'Debt Management',
      subtitle: 'Track debts owed to you and by you',
      createNew: 'Create New Debt Record',
      personName: 'Person Name',
      enterName: 'Enter person name',
      selectWallet: 'Select Wallet',
      selectCurrency: 'Select Currency',
      amount: 'Amount',
      give: 'I Owe',
      get: 'Owed to Me',
      created: 'Debt record created successfully',
      debtsOwed: 'Debts I Owe',
      debtsOwedToMe: 'Debts Owed to Me',
      totalOwed: 'Total I Owe',
      totalOwedToMe: 'Total Owed to Me',
      by: 'by',
      to: 'to',
      recordDebt: 'Record Debt',
      noDebtsOwed: 'You don\'t owe any debts',
      noDebtsOwedToMe: 'No debts are owed to you',
      paid: 'Paid',
      markAsPaid: 'Mark as Paid',
      markedAsPaid: 'Debt marked as paid successfully',
      selectWalletFirst: 'Select a wallet first',
      afterGiving: 'Balance after giving',
      afterReceiving: 'Balance after receiving',
      noDebts: 'No debts',
      dateCreated: 'Date Created',
      noDepts: 'No debts found',
      searchDebts: 'Search debts',
      filterBy: 'Filter by',
      all: 'All',
      iOwe: 'I Owe',
      owedToMe: 'Owed to Me',
      settleDebt: 'Settle Debt',
      settleConfirm: 'Mark this debt as settled?',
      settled: 'Settled',
      active: 'Active',
      markAsSettled: 'Mark as Settled',
      note: 'Note (Optional)',
      addNote: 'Add a note'
    },
    treasurer: {
      title: 'Cash Custody Management',
      subtitle: 'Manage cash custody between treasurer and cashiers',
      giveCustody: 'Give Custody to Cashier',
      getCustody: 'Get Custody from Cashier',
      selectCashier: 'Select Cashier',
      cashierName: 'Cashier Name',
      currencyType: 'Currency Type',
      amount: 'Amount',
      selectAction: 'Select Action',
      actionRequired: 'Please select an action first',
      cashierRequired: 'Please select a cashier',
      currencyRequired: 'Please select a currency',
      amountRequired: 'Please enter an amount',
      amountInvalid: 'Please enter a valid amount',
      confirmCustody: 'Confirm Custody Transfer',
      successGive: 'Cash custody successfully given to cashier',
      successGet: 'Cash custody successfully received from cashier',
      notes: 'Notes (Optional)',
      processingCustody: 'Processing custody transfer...',
      insufficientFunds: 'Insufficient funds for this operation',
      selectCurrency: 'Select Currency'
    },
    walletManagement: {
      title: 'Wallet Management',
      addFunds: 'Add Funds to Wallet',
      selectWallet: 'Select Wallet',
      selectWalletPrompt: 'Please select a wallet from the list',
      currency: 'Currency',
      amount: 'Amount',
      notes: 'Notes (Optional)',
      notesPlaceholder: 'Enter any notes about this transaction',
      enterAmount: 'Enter amount',
      currentBalance: 'Current Balance',
      walletList: 'Wallet List',
      noWallets: 'No wallets found',
      selectCurrency: 'Select Currency',
      fillAllFields: 'Please fill all required fields',
      invalidAmount: 'Please enter a valid amount',
      processing: 'Processing...',
      success: 'Success',
      fundsAddedSuccessfully: 'Funds added successfully to the wallet',
      errorLoadingWallets: 'Error Loading Wallets',
      errorAddingFunds: 'Error Adding Funds',
      managerDeposit: 'Manager deposit',
      noBalances: 'No balances found'
    },
    
    cashier: {
      title: 'Cashier Interface',
      subtitle: 'Buy and sell currency, generate reports',
      buyButton: 'Buy Currency',
      sellButton: 'Sell Currency',
      reportButton: 'Generate Report',
      cashInCustody: 'Cash in Custody',
      buyRates: 'Buy Rates',
      sellRates: 'Sell Rates',
      oldDinar: 'Old Dinar',
      newDinar: 'New Dinar',
      buyTitle: 'Buy Currency',
      buySubtitle: 'Record purchase of currency from customers',
      sellTitle: 'Sell Currency',
      sellSubtitle: 'Record sales of currency to customers',
      currentBuyRates: 'Current Buy Rates',
      currentSellRates: 'Current Sell Rates',
      buyPagePlaceholder: 'Buy Currency interface will be implemented here',
      sellPagePlaceholder: 'Sell Currency interface will be implemented here',
      comingSoon: 'Coming Soon',
      
      // Form fields
      currencyType: 'Currency Type',
      currencyCode: 'Currency',
      selectCurrencyType: 'Select currency type',
      amountToBuy: 'Amount to Buy',
      amountToSell: 'Amount to Sell',
      price: 'Price',
      sourceWallet: 'Source',
      destinationWallet: 'Destination',
      personalCustody: 'Personal Custody',
      clientDirectly: 'Client Directly',
      selectWallet: 'Select wallet',
      clientName: 'Client Name',
      enterClientName: 'Enter client name',
      receivedAmount: 'Received Amount',
      totalAmount: 'Total Amount',
      
      // Actions
      processing: 'Processing...',
      completePurchase: 'Complete Purchase',
      completeSale: 'Complete Sale',
      
      // Currency exchange
      currencyToReceive: 'Currency to Receive from Customer',
      currencyToPay: 'Currency to Pay to Customer',
      currencyToSell: 'Currency to Sell to Customer',
      exchangeRate: 'Exchange Rate',
      exchangeDescription: 'Transaction Summary',
      buying: 'Receiving',
      paying: 'Paying with',
      selling: 'Selling',
      receiving: 'Receiving',
      andPaying: 'and paying with',
      andReceiving: 'and receiving',
      fromCustomer: 'From customer',
      toCustomer: 'To customer',
      selectBothCurrencies: 'Please select both currencies',
      oldDinarSelected: 'Old Libyan Dinar selected',
      newDinarSelected: 'New Libyan Dinar selected',
      
      // Enhanced transaction details
      transactionDetails: 'Transaction Details',
      transactionSummary: 'Transaction Summary',
      amountReceiving: 'Amount Receiving',
      amountSelling: 'Amount Selling',
      atRate: 'At Rate',
      amountHelp: 'Enter the amount you are processing'
    }
  },  
  ar: {
    appTitle: 'إدارة الصرافة',
    nav: { 
      dashboard: 'لوحة المدير', 
      withdrawals: 'المصروفات والتقارير', 
      create: 'إنشاء الكيانات',
      cashier: 'واجهة الصراف',
      executioner: 'منفذ الصفقات',
      debtManagement: 'إدارة الديون',
      treasurer: 'إدارة العهد النقدية',
      cashCustody: 'العهد النقدية',
      userManagement: 'إدارة المستخدمين',
      walletManagement: 'إدارة المحافظ',
      changePassword: 'تغيير كلمة المرور',
      logout: 'تسجيل الخروج',
      account: 'الحساب',
      menu: 'القائمة'
    },
    // Flattened keys for Arabic
    'userManagement.title': 'إدارة المستخدمين',
    'userManagement.users': 'المستخدمون',
    'userManagement.email': 'البريد الإلكتروني',
    'userManagement.name': 'الاسم',
    'userManagement.currentRole': 'الدور الحالي',
    'userManagement.assignRole': 'تعيين دور',
    'userManagement.loadingUsers': 'جارٍ تحميل المستخدمين...',
    'userManagement.noUsersFound': 'لم يتم العثور على مستخدمين',
    'userManagement.noRoleAssigned': 'لم يتم تعيين دور',
    'userManagement.roleUpdated': 'تم تحديث دور المستخدم بنجاح',
    'userManagement.failedToLoad': 'فشل التحميل',
    'userManagement.couldNotLoadUsers': 'تعذر تحميل المستخدمين',
    'userManagement.roleUpdateFailed': 'فشل تحديث الدور',
    'userManagement.roleUpdateSuccess': 'تم تحديث دور المستخدم بنجاح',

    'roles.manager': 'مدير',
    'roles.treasurer': 'أمين صندوق',
    'roles.cashier': 'صراف',
    'roles.dealings_executioner': 'منفذ صفقات',
    'roles.selectRole': 'اختر دوراً',
    'roles.loadingRoles': 'جارٍ تحميل الأدوار...',
    'roles.noRolesAvailable': 'لا توجد أدوار متاحة',
    'roles.solution': 'الحل',
    'roles.runFixRoles': 'قم بتشغيل npm run fix:roles للإصلاح.',
    'roles.noRolesInDatabase': 'لم يتم العثور على أدوار في قاعدة البيانات.',
    'roles.runFixRolesToCreate': 'قم بتشغيل npm run fix:roles لإنشاء جدول الأدوار.',

    'create.role': 'الدور',
    'create.title': 'إنشاء الكيانات',
    'create.wallet': 'إنشاء محفظة',
    'create.name': 'الاسم',
    'create.initUsd': 'الدولار الابتدائي',
    'create.initLyd': 'الدينار الابتدائي',
    'create.create': 'إنشاء',
    'create.user': 'إنشاء مستخدم',
    'create.email': 'البريد الإلكتروني',
    'create.phone': 'الهاتف',
    'create.password': 'كلمة المرور',
    'create.operation': 'إنشاء نوع معاملات',
    'create.operationName': 'اسم المعاملة',
    'create.currencyType': 'إنشاء نوع عملة',
    'create.currencyCode': 'رمز العملة',
    'create.currencyName': 'اسم العملة',
    'create.currencySymbol': 'رمز العملة (اختياري)',
    'create.addCurrency': 'إضافة عملة',
    'create.initialBalance': 'الرصيد الأولي',
    
    'custodyManagement.title': 'إدارة العهد النقدية',
    'custodyManagement.refresh': 'تحديث',
    'custodyManagement.custodyGiven': 'العهد المعطاة',
    'custodyManagement.noCustodyGiven': 'لا توجد عهدات معطاة',
    'custodyManagement.custodyReceived': 'العهد المستلمة',
    'custodyManagement.noCustodyReceived': 'لا توجد عهدات مستلمة',
    'custodyManagement.date': 'التاريخ',
    'custodyManagement.cashier': 'الصراف',
    'custodyManagement.treasurer': 'أمين الصندوق',
    'custodyManagement.wallet': 'المحفظة',
    'custodyManagement.amount': 'المبلغ',
    'custodyManagement.status': 'الحالة',
    'custodyManagement.actions': 'الإجراءات',
    'custodyManagement.pending': 'قيد الانتظار',
    'custodyManagement.approved': 'تمت الموافقة',
    'custodyManagement.rejected': 'مرفوض',
    'custodyManagement.returned': 'معاد',
    'custodyManagement.approve': 'موافقة',
    'custodyManagement.reject': 'رفض',
    'custodyManagement.markReturned': 'تحديد كمعاد',
    'custodyManagement.approvalSuccess': 'تمت الموافقة على طلب العهدة بنجاح',
    'custodyManagement.rejectionSuccess': 'تم رفض طلب العهدة',
    'custodyManagement.returnSuccess': 'تم تحديد العهدة كمعادة',
    'custodyManagement.approvalFailed': 'فشلت الموافقة',
    'custodyManagement.rejectionFailed': 'فشل الرفض',
    'custodyManagement.returnFailed': 'فشل تحديد العهدة كمعادة',
    
    // Dashboard flattened keys - Arabic
    'dashboard.title': 'لوحة المدير',
    'dashboard.totals': 'الإجماليات',
    'dashboard.totalUsd': 'إجمالي الدولار',
    'dashboard.totalLyd': 'إجمالي الدينار',
    'dashboard.numWallets': 'عدد المحافظ',
    'dashboard.selectWallet': 'اختر المحفظة',
    'dashboard.walletBalances': 'أرصدة المحفظة',
    'dashboard.usd': 'دولار',
    'dashboard.lyd': 'دينار',
    'dashboard.buyInfo': 'معلومات شراء الدينار',
    'dashboard.sellInfo': 'معلومات بيع الدينار',
    'dashboard.lowest': 'الأدنى',
    'dashboard.median': 'الوسطي',
    'dashboard.highest': 'الأعلى',
    'dashboard.managerPrices': 'أسعار المدير',
    'dashboard.sellold': 'بيع الدينار القديم',
    'dashboard.sellnew': 'بيع الدينار الجديد',
    'dashboard.buyold': 'شراء الدينار القديم',
    'dashboard.buynew': 'شراء الدينار الجديد',
    'dashboard.save': 'حفظ الأسعار',
    'dashboard.custodySummary': 'ملخص العهدات',
    'dashboard.summaryTotals': 'مجاميع الملخص',
    
    // Treasurer flattened keys - Arabic
    'treasurer.title': 'إدارة العهد النقدية',
    'treasurer.subtitle': 'إدارة العهد النقدية بين أمين الصندوق والصرافين',
    'treasurer.giveCustody': 'إعطاء عهدة للصراف',
    'treasurer.getCustody': 'استلام عهدة من الصراف',
    'treasurer.selectCashier': 'اختر الصراف',
    'treasurer.cashierName': 'اسم الصراف',
    'treasurer.currencyType': 'نوع العملة',
    'treasurer.amount': 'المبلغ',
    'treasurer.selectAction': 'اختر الإجراء',
    'treasurer.actionRequired': 'الرجاء اختيار الإجراء أولاً',
    'treasurer.cashierRequired': 'الرجاء اختيار صراف',
    'treasurer.currencyRequired': 'الرجاء اختيار عملة',
    'treasurer.amountRequired': 'الرجاء إدخال المبلغ',
    'treasurer.amountInvalid': 'الرجاء إدخال مبلغ صحيح',
    'treasurer.confirmCustody': 'تأكيد تحويل العهدة',
    'treasurer.successGive': 'تم إعطاء العهدة النقدية للصراف بنجاح',
    'treasurer.successGet': 'تم استلام العهدة النقدية من الصراف بنجاح',
    'treasurer.notes': 'ملاحظات (اختياري)',
    'treasurer.processingCustody': 'جارٍ معالجة تحويل العهدة...',
    'treasurer.insufficientFunds': 'رصيد غير كافٍ لهذه العملية',
    'treasurer.selectCurrency': 'اختر العملة',
    'treasurer.custodyHistory': 'سجل العهدات',
    
    // Currency Pairs
    'currencyPairs.pair': 'زوج العملة',
    'currencyPairs.medianRate': 'السعر الوسطي',
    'currencyPairs.minRate': 'السعر الأدنى',
    'currencyPairs.maxRate': 'السعر الأعلى',
    'currencyPairs.transactions': 'المعاملات',
    'currencyPairs.totalAmount': 'المبلغ الإجمالي',
    'currencyPairs.avgAmount': 'المتوسط',
    'currencyPairs.noData': 'لا توجد بيانات تبادل عملات متاحة',
    'currencyPairs.totalPairs': 'إجمالي أزواج العملات',
    'currencyPairs.totalTransactions': 'إجمالي معاملات التبادل',
    'currencyPairs.overallMedianRates': 'معدلات الصرف الوسطية الإجمالية',
    'currencyPairs.basedOnTransactions': 'بناءً على',
    'currencyPairs.currencyPair': 'زوج العملة',
    'currencyPairs.marketActivity': 'نشاط السوق',
    'currencyPairs.calculator': 'حاسبة',
    'currencyPairs.txs': 'معاملة',
    'currencyPairs.activePairs': 'أزواج العملات النشطة',
    'currencyPairs.totalExchanges': 'إجمالي التبادلات',
    'currencyPairs.totalVolume': 'الحجم الإجمالي',
    'currencyPairs.noExchangeData': 'لا توجد بيانات معاملات تبادل متاحة',
    'currencyPairs.walletAnalysis': 'تحليل عملات المحفظة',
    'currencyPairs.exchangeRateAnalysis': 'تحليل أسعار الصرف',
    'currencyPairs.enterAmount': 'أدخل المبلغ',
    'currencyPairs.convertedAmount': 'المبلغ المحول',
    'currencyPairs.rateUsed': 'السعر المستخدم',
    'currencyPairs.operations': 'العمليات',
    'currencyPairs.buying': 'شراء',
    'currencyPairs.selling': 'بيع',
    'currencyPairs.buy': 'شراء',
    'currencyPairs.sell': 'بيع',
    'currencyPairs.overallExchangeRates': 'أسعار الصرف الإجمالية',
    'currencyPairs.exchangeRateAnalysis': 'تحليل أسعار الصرف',
    login: { title: 'تسجيل دخول المدير', email: 'البريد الإلكتروني', password: 'كلمة المرور', submit: 'دخول' },
    dashboard: {
      totals: 'الإجماليات', totalUsd: 'إجمالي الدولار', totalLyd: 'إجمالي الدينار', numWallets: 'عدد المحافظ',
      selectWallet: 'اختر المحفظة', walletBalances: 'أرصدة المحفظة', usd: 'دولار', lyd: 'دينار',
      buyInfo: 'معلومات شراء الدينار', sellInfo: 'معلومات بيع الدينار', lowest: 'الأدنى', median: 'الوسطي', highest: 'الأعلى',
      managerPrices: 'أسعار المدير', sellold: 'بيع الدينار القديم', sellnew: 'بيع الدينار الجديد', buyold: 'شراء الدينار القديم', buynew: 'شراء الدينار الجديد', save: 'حفظ الأسعار'
    },    
    withdrawals: {
      title: 'المصروفات والتقارير', chooseWallet: 'اختر المحفظة', usd: 'الدولار المسحوب', lyd: 'الدينار المسحوب', reason: 'السبب', confirm: 'تأكيد السحب',
      reportType: 'نوع التقرير', exportPdf: 'تصدير PDF', currency: 'العملة المراد سحبها', amount: 'المبلغ المراد سحبه'
    },
    updatePassword: {
      title: 'تغيير كلمة المرور', 
      newPassword: 'كلمة المرور الجديدة', 
      confirmPassword: 'تأكيد كلمة المرور',
      passwordPlaceholder: 'أدخل كلمة المرور الجديدة',
      confirmPasswordPlaceholder: 'تأكيد كلمة المرور الجديدة',
      passwordRequired: 'كلمة المرور مطلوبة',
      passwordLength: 'يجب أن تكون كلمة المرور على الأقل 6 أحرف',
      passwordMismatch: 'كلمات المرور غير متطابقة',
      success: 'تم تحديث كلمة المرور بنجاح',
      error: 'فشل في تحديث كلمة المرور',
      updating: 'جاري التحديث...',
      submit: 'تحديث كلمة المرور'
    },
    create: {
      title: 'إنشاء الكيانات', wallet: 'إنشاء محفظة', name: 'الاسم', initUsd: 'الدولار الابتدائي', initLyd: 'الدينار الابتدائي', create: 'إنشاء',
      user: 'إنشاء مستخدم', email: 'البريد الإلكتروني', phone: 'الهاتف', password: 'كلمة المرور',
      operation: 'إنشاء نوع معاملات', operationName: 'اسم المعاملة',
      currencyType: 'إنشاء نوع عملة', currencyCode: 'رمز العملة', currencyName: 'اسم العملة',
      currencySymbol: 'رمز العملة (اختياري)', addCurrency: 'إضافة عملة', initialBalance: 'الرصيد الأولي'
    },
    common: {
      cancel: 'إلغاء',
      back: 'رجوع',
      close: 'إغلاق',
      save: 'حفظ',
      saving: 'جاري الحفظ...',
      delete: 'حذف',
      deleted: 'تم الحذف بنجاح',
      paid: 'تحديد كمدفوع',
      loading: 'جاري التحميل...',
      notes: 'ملاحظات',
      selectOption: 'اختر خياراً',
      failedToLoadData: 'فشل في تحميل البيانات',
      failedToSave: 'فشل في الحفظ',
      availableBalance: 'الرصيد المتاح',
      fillRequiredFields: 'الرجاء ملء جميع الحقول المطلوبة',
      failed: 'فشلت العملية'
    },
    executioner: {
      title: 'منفذ الصفقات',
      subtitle: 'مراقبة وتصديق معاملات العملات',
      currentRates: 'أسعار الصرف الحالية',
      transactions: 'سجلات المعاملات',
      pending: 'بانتظار التصديق',
      completed: 'مصدّق عليها',
      needsValidation: 'تحتاج إلى تصديق',
      validate: 'تصديق',
      details: 'تفاصيل',
      transactionType: 'النوع',
      cashierName: 'الصراف',
      clientName: 'العميل',
      source: 'المصدر',
      destination: 'الوجهة',
      amount: 'الكمية',
      totalAmount: 'المجموع',
      status: 'الحالة',
      date: 'التاريخ',
      time: 'الوقت',
      actions: 'الإجراءات',
      buy: 'شراء',
      sell: 'بيع',
      filter: 'تصفية',
      all: 'الكل',
      validated: 'تم التصديق',
      notValidated: 'غير مصدق',
      validateTransaction: 'تصديق المعاملة',
      validationConfirmation: 'هل أنت متأكد أنك تريد تصديق هذه المعاملة؟',
      transactionValidated: 'تم تصديق المعاملة بنجاح',
      validatedBy: 'تم التصديق بواسطة',
      validatedAt: 'تم التصديق في',
      transactionDetails: 'تفاصيل المعاملة',
      exchangeRate: 'سعر الصرف',
      wallet: 'المحفظة',
      searchTransactions: 'البحث في المعاملات',
      noTransactions: 'لم يتم العثور على معاملات',
      highValue: 'قيمة مرتفعة',
      needsAttention: 'يحتاج انتباه'
    },
    debtManagement: {
      title: 'إدارة الديون',
      subtitle: 'تتبع الديون المستحقة لك وعليك',
      createNew: 'إنشاء سجل دين جديد',
      personName: 'اسم الشخص',
      enterName: 'أدخل اسم الشخص',
      selectWallet: 'اختر المحفظة',
      selectCurrency: 'اختر العملة',
      amount: 'المبلغ',
      give: 'إعطاء (أنا مدين)',
      get: 'استلام (مدين لي)',
      created: 'تم إنشاء سجل الدين بنجاح',
      debtsOwed: 'الديون التي أدين بها',
      debtsOwedToMe: 'الديون المستحقة لي',
      totalOwed: 'إجمالي ما أدين به',
      totalOwedToMe: 'إجمالي ما هو مدين لي',
      by: 'من قبل',
      to: 'إلى',
      dateCreated: 'تاريخ الإنشاء',
      noDepts: 'لم يتم العثور على ديون',
      searchDebts: 'البحث في الديون',
      filterBy: 'تصفية حسب',
      all: 'الكل',
      iOwe: 'أنا مدين',
      owedToMe: 'مدين لي',
      afterGiving: 'الرصيد بعد الإعطاء',
      afterReceiving: 'الرصيد بعد الاستلام',
      settleDebt: 'تسوية الدين',
      settleConfirm: 'هل تريد تحديد هذا الدين كمسدد؟',
      settled: 'تمت التسوية',
      active: 'نشط',
      markAsSettled: 'تحديد كمسدد',
      note: 'ملاحظة (اختياري)',
      addNote: 'إضافة ملاحظة'
    },
    treasurer: {
      title: 'إدارة العهد النقدية',
      subtitle: 'إدارة العهد النقدية بين أمين الصندوق والصرافين',
      giveCustody: 'إعطاء عهدة للصراف',
      getCustody: 'استلام عهدة من الصراف',
      selectCashier: 'اختر الصراف',
      cashierName: 'اسم الصراف',
      currencyType: 'نوع العملة',
      amount: 'المبلغ',
      selectAction: 'اختر الإجراء',
      actionRequired: 'الرجاء اختيار الإجراء أولاً',
      cashierRequired: 'الرجاء اختيار صراف',
      currencyRequired: 'الرجاء اختيار عملة',
      amountRequired: 'الرجاء إدخال المبلغ',
      amountInvalid: 'الرجاء إدخال مبلغ صحيح',
      confirmCustody: 'تأكيد تحويل العهدة',
      successGive: 'تم إعطاء العهدة النقدية للصراف بنجاح',
      successGet: 'تم استلام العهدة النقدية من الصراف بنجاح',
      notes: 'ملاحظات (اختياري)',
      processingCustody: 'جارٍ معالجة تحويل العهدة...',
      insufficientFunds: 'رصيد غير كافٍ لهذه العملية',
      selectCurrency: 'اختر العملة',
      custodyHistory: 'سجل العهدات',
      wallet: 'المحفظة',
      availableBalance: 'الرصيد المتاح'
    },
    walletManagement: {
      title: 'إدارة المحافظ',
      addFunds: 'إضافة أموال للمحفظة',
      selectWallet: 'اختر المحفظة',
      selectWalletPrompt: 'الرجاء اختيار محفظة من القائمة',
      currency: 'العملة',
      amount: 'المبلغ',
      notes: 'ملاحظات (اختياري)',
      notesPlaceholder: 'أدخل أي ملاحظات عن هذه المعاملة',
      enterAmount: 'أدخل المبلغ',
      currentBalance: 'الرصيد الحالي',
      walletList: 'قائمة المحافظ',
      noWallets: 'لا توجد محافظ',
      selectCurrency: 'اختر العملة',
      fillAllFields: 'الرجاء تعبئة جميع الحقول المطلوبة',
      invalidAmount: 'الرجاء إدخال مبلغ صحيح',
      processing: 'جاري المعالجة...',
      success: 'تم بنجاح',
      fundsAddedSuccessfully: 'تمت إضافة الأموال بنجاح إلى المحفظة',
      errorLoadingWallets: 'خطأ في تحميل المحافظ',
      errorAddingFunds: 'خطأ في إضافة الأموال',
      managerDeposit: 'إيداع المدير',
      noBalances: 'لا توجد أرصدة'
    },
    
    custodyManagement: {
      title: 'إدارة العهد النقدية',
      refresh: 'تحديث',
      custodyGiven: 'العهد المعطاة',
      noCustodyGiven: 'لا توجد عهدات معطاة',
      custodyReceived: 'العهد المستلمة',
      noCustodyReceived: 'لا توجد عهدات مستلمة',
      date: 'التاريخ',
      cashier: 'الصراف',
      treasurer: 'أمين الصندوق',
      wallet: 'المحفظة',
      amount: 'المبلغ',
      status: 'الحالة',
      actions: 'الإجراءات',
      pending: 'قيد الانتظار',
      approved: 'تمت الموافقة',
      rejected: 'مرفوض',
      returned: 'معاد',
      approve: 'موافقة',
      reject: 'رفض',
      markReturned: 'تحديد كمعاد',
      approvalSuccess: 'تمت الموافقة على طلب العهدة بنجاح',
      rejectionSuccess: 'تم رفض طلب العهدة',
      returnSuccess: 'تم تحديد العهدة كمعادة',
      approvalFailed: 'فشلت الموافقة',
      rejectionFailed: 'فشل الرفض',
      returnFailed: 'فشل تحديد العهدة كمعادة',
      cancel: 'إلغاء',
      giveCustody: 'إعطاء العهدة',
      processing: 'جارٍ المعالجة...'
    },
    
    roles: {
      manager: 'مدير',
      treasurer: 'أمين صندوق',
      cashier: 'صراف',
      dealings_executioner: 'منفذ صفقات',
      role: 'الدور',
      selectRole: 'اختر دوراً',
      loadingRoles: 'جارٍ تحميل الأدوار...',
      noRolesAvailable: 'لا توجد أدوار متاحة',
      refreshRoles: 'تحديث',
      roleError: 'لم يتم العثور على أدوار في قاعدة البيانات. تأكد من وجود جدول الأدوار وملئه بالبيانات.',
      noRolesFound: 'لم يتم العثور على أدوار في قاعدة البيانات.'
    },
    
    userManagement: {
      title: 'إدارة المستخدمين',
      users: 'المستخدمون',
      loadingUsers: 'جارٍ تحميل المستخدمين...',
      noUsers: 'لا يوجد مستخدمون',
      email: 'البريد الإلكتروني',
      name: 'الاسم',
      currentRole: 'الدور الحالي',
      assignRole: 'تعيين دور',
      noRoleAssigned: 'لم يتم تعيين دور',
      roleUpdated: 'تم تحديث دور المستخدم بنجاح',
      failedToUpdateRole: 'فشل تحديث الدور',
      unknown: 'غير معروف'
    },
    
    cashier: {
      title: 'واجهة الصراف',
      subtitle: 'شراء وبيع العملة، إنشاء التقارير',
      buyButton: 'شراء العملة',
      sellButton: 'بيع العملة',
      reportButton: 'إنشاء تقرير',
      cashInCustody: 'النقد في العهدة',
      buyRates: 'أسعار الشراء',
      sellRates: 'أسعار البيع',
      oldDinar: 'الدينار القديم',
      newDinar: 'الدينار الجديد',
      buyTitle: 'شراء العملة',
      buySubtitle: 'تسجيل شراء العملة من العملاء',
      sellTitle: 'بيع العملة',
      sellSubtitle: 'تسجيل بيع العملة للعملاء',
      currentBuyRates: 'أسعار الشراء الحالية',
      currentSellRates: 'أسعار البيع الحالية',
      buyPagePlaceholder: 'واجهة شراء العملة ستكون هنا',
      sellPagePlaceholder: 'واجهة بيع العملة ستكون هنا',
      comingSoon: 'قريباً',
      
      // Form fields
      currencyType: 'نوع العملة',
      currencyCode: 'العملة',
      selectCurrencyType: 'اختر نوع العملة',
      amountToBuy: 'كمية الشراء',
      amountToSell: 'كمية البيع',
      price: 'السعر',
      sourceWallet: 'المصدر',
      destinationWallet: 'الوجهة',
      personalCustody: 'العهدة الشخصية',
      clientDirectly: 'العميل مباشرة',
      selectWallet: 'اختر المحفظة',
      clientName: 'اسم العميل',
      enterClientName: 'أدخل اسم العميل',
      receivedAmount: 'المبلغ المستلم',
      totalAmount: 'المبلغ الإجمالي',
      
      // Actions
      processing: 'جاري المعالجة...',
      completePurchase: 'إتمام الشراء',
      completeSale: 'إتمام البيع',
      
      // Currency exchange
      currencyToReceive: 'العملة التي تستلم من العميل',
      currencyToPay: 'العملة التي تدفع للعميل',
      currencyToSell: 'العملة التي تبيع للعميل',
      exchangeRate: 'سعر الصرف',
      exchangeDescription: 'ملخص المعاملة',
      buying: 'استلام',
      paying: 'الدفع بواسطة',
      selling: 'بيع',
      receiving: 'استلام',
      andPaying: 'ودفع',
      andReceiving: 'واستلام',
      fromCustomer: 'من العميل',
      toCustomer: 'إلى العميل',
      selectBothCurrencies: 'الرجاء اختيار العملتين',
      oldDinarSelected: 'تم اختيار الدينار الليبي القديم',
      newDinarSelected: 'تم اختيار الدينار الليبي الجديد',
      
      // Enhanced transaction details
      transactionDetails: 'تفاصيل المعاملة',
      transactionSummary: 'ملخص المعاملة',
      amountReceiving: 'الكمية المستلمة',
      amountSelling: 'الكمية المباعة',
      atRate: 'بسعر',
      amountHelp: 'أدخل الكمية التي تتم معالجتها'
    }
  }
}

const I18nContext = createContext(null)

export function I18nProvider({ children }) {
  const initial = typeof localStorage !== 'undefined' ? (localStorage.getItem('lang') || 'en') : 'en'
  const [lang, setLang] = useState(initial)
  const dir = lang === 'ar' ? 'rtl' : 'ltr'
  const toggleLang = () => setLang(prev => {
    const next = prev === 'en' ? 'ar' : 'en'
    try { localStorage.setItem('lang', next) } catch {}
    return next
  })
  
  // Translation function that properly handles nested object access
  const t = (key) => {
    // If key is not a string, return the key itself
    if (typeof key !== 'string') return key;
    
    try {
      // First try direct access to see if the key exists as a flattened key
      if (strings[lang] && strings[lang][key] !== undefined) {
        return strings[lang][key];
      }
      
      // If not found directly, try to traverse the nested structure
      if (key.includes('.')) {
        const parts = key.split('.');
        let current = strings[lang];
        
        for (const part of parts) {
          if (current && current[part] !== undefined) {
            current = current[part];
          } else {
            // Key path not found in translations
            console.warn(`Translation key not found: ${key}`);
            return key; // Return key as fallback
          }
        }
        return current;
      }
      
      // Key not found
      console.warn(`Translation key not found: ${key}`);
      return key;
    } catch (error) {
      console.error(`Error in translation function for key: ${key}`, error);
      return key; // Fallback to key on error
    }
  }
  
  const value = useMemo(() => ({ lang, setLang, toggleLang, dir, t }), [lang, dir])
  
  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  )
}

export function useI18n() {
  const context = useContext(I18nContext)
  if (!context) {
    throw new Error('useI18n must be used within an I18nProvider')
  }
  return context
}