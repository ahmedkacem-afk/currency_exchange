# UUID Management in Currency Exchange App

## Overview

This project uses UUIDs as primary keys for most database tables (except for the manager_prices table). 
This document explains how UUID generation and user creation work in the application.

## UUID Generation

The application uses a custom UUID generation utility that falls back to a manual implementation if the native `crypto.randomUUID()` is not available.

### Key Files:

- `src/lib/uuid.js` - Contains the UUID generation utility
- `src/lib/entityHelpers.js` - Provides helper functions for consistent entity creation

### How to Use:

```javascript
// Import the utility
import { generateUUID } from './lib/uuid';
import { prepareNewEntity } from './lib/entityHelpers';

// Generate a UUID directly
const id = generateUUID();

// Prepare an entity for insertion (adds UUID only)
const entityData = prepareNewEntity({
  name: 'Example',
  description: 'This is an example'
});

// Result:
// {
//   id: '123e4567-e89b-12d3-a456-426614174000', // UUID
//   name: 'Example',
//   description: 'This is an example'
// }
```

## User Creation Process

The user creation process involves two steps:

1. Create a user in Supabase Auth (which generates a UUID)
2. Create a profile in the users table with the same UUID

### Code Flow:

1. `createUser()` function in `supabaseApi.js` is called
2. It creates a user in Supabase Auth with `supabase.auth.signUp()`
3. It then creates a profile in the users table using the UUID from auth
4. If the profile creation fails, it attempts to clean up the auth user

### Example:

```javascript
// Creating a user
const { user } = await createUser({
  name: 'John Doe',
  email: 'john@example.com',
  phone: '+1234567890',
  password: 'password123',
  role: 'user'
});

// The user object will have the UUID generated by Supabase Auth
console.log(user.id); // UUID from auth
```

## Tables Using UUIDs

The following tables use UUIDs as primary keys:

- users (uses Auth UUID)
- wallets
- transactions
- operations
- entities

## Testing

You can run the UUID test script to verify UUID generation:

```bash
node test-uuid.js
```
